@model StockSale.App.Models.ViewModels.AddProductViewModel

<h1 class="title mb-4">Añadir Producto</h1>

<div class="container py-2">
    <form method="post" id="addProductForm">
        <div class="two-grid">
            <div class="inputBox">
                <input type="text" id="name" asp-for="Name" required />
                <span>Nombre</span>
            </div>
            <div class="inputBox">
                <input type="text" id="packaging" asp-for="Packaging" required />
                <span>Packaging</span>
            </div>
            <div class="inputBox">
                <input type="number" asp-for="Stock" required />
                <span>Stock</span>
            </div>
            <div class="inputBox">
                <input type="number" asp-for="Stock_Limit" required />
                <span>Stock Límite</span>
            </div>
            <div class="inputBox">
                <input type="number" asp-for="List_Price" required />
                <span>Precio de Lista</span>
            </div>
            <div class="inputBox">
                <input type="number" asp-for="Sell_Price" required />
                <span>Precio de Venta</span>
            </div>

            <!-- Barcode readonly input -->
            <div class="editBox">
                <label>Barcode</label>
                <input type="text" asp-for="Barcode" id="barcode" readonly />
                <button type="button" id="btnOpenBarcodeModal" class="conf-button mt-1" style="width: 100%;">
                    Ingresar código
                </button>
            </div>

            <!-- Dropdown para Proveedores -->
            <div class="inputBox">
                <select class="form-control" asp-for="ProviderId" asp-items="@(new SelectList(Model.Providers, "Id", "Name"))">
                    <option id="defaultOption" value="">Seleccione un proveedor</option>
                </select>
                <span>Proveedor</span>
            </div>

            <!-- Dropdown para Unidades de Medida -->
            <div class="inputBox">
                <select class="form-control" asp-for="UnitMId" asp-items="@(new SelectList(Model.UnitsM, "Id", "Name"))">
                    <option value="">Seleccione la unidad de medida</option>
                </select>
                <span>Unidad de Medida</span>
            </div>
        </div>

        <div class="btn-center mt-3">
            <button type="submit" class="conf-button w-50">
                <span class="text">Guardar</span>
            </button>
        </div>
    </form>
</div>

<!-- Modal para ingresar barcode manualmente -->
<div id="barcodeModal" style="display:none; position: fixed; z-index: 1000; left:0; top:0; width:100%; height:100%; overflow:auto; background-color: rgba(0,0,0,0.5);">
    <div style="background-color: white; margin: 10% auto; padding: 20px; border-radius: 8px; width: 300px; position: relative;">
        <h3>Ingresar Código de Barras</h3>
        <input type="text" id="barcodeInput" style="width: 100%; padding: 8px; margin-top: 10px;" placeholder="Escanea o escribe el código" autofocus />
        <div style="margin-top: 15px; display: flex; justify-content: space-between;">
            <button type="button" id="btnSaveBarcode" class="conf-button" style="flex: 1; margin-right: 5px;">Guardar</button>
            <button type="button" id="btnCloseBarcodeModal" class="dlt-button" style="flex: 1;">Cancelar</button>
        </div>
    </div>
</div>

@section Scripts {
    <script>
        // Abrir modal
        document.getElementById('btnOpenBarcodeModal').addEventListener('click', function () {
            document.getElementById('barcodeModal').style.display = 'block';
            document.getElementById('barcodeInput').value = '';
            document.getElementById('barcodeInput').focus();
        });

        // Guardar barcode y cerrar modal
        document.getElementById('btnSaveBarcode').addEventListener('click', function () {
            var barcodeValue = document.getElementById('barcodeInput').value.trim();
            if (barcodeValue.length > 0) {
                document.getElementById('barcode').value = barcodeValue;
            }
            document.getElementById('barcodeModal').style.display = 'none';
        });

        // Cerrar modal sin guardar
        document.getElementById('btnCloseBarcodeModal').addEventListener('click', function () {
            document.getElementById('barcodeModal').style.display = 'none';
        });

        // También cerrar modal si el usuario hace click afuera del contenido
        window.onclick = function (event) {
            var modal = document.getElementById('barcodeModal');
            if (event.target == modal) {
                modal.style.display = "none";
            }
        };

        // Opcional: al presionar Enter en el input modal, guarda y cierra
        document.getElementById('barcodeInput').addEventListener('keydown', function (e) {
            if (e.key === 'Enter') {
                e.preventDefault();
                document.getElementById('btnSaveBarcode').click();
            }
        });
    </script>
}
